"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[25790],{27088:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>h});var s=n(85893),d=n(11151),r=n(4106);const t={},c="Media Service",a={id:"docs/dev-manuals/services/media",title:"Media Service",description:"The media service provides the bounded context Media.",source:"@site/docs/docs/dev-manuals/services/media.mdx",sourceDirName:"docs/dev-manuals/services",slug:"/docs/dev-manuals/services/media",permalink:"/docs/docs/dev-manuals/services/media",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Invoice Service",permalink:"/docs/docs/dev-manuals/services/invoice"},next:{title:"Notification Service",permalink:"/docs/docs/dev-manuals/services/notification"}},l={},h=[{value:"Domain Model",id:"domain-model",level:2},{value:"API",id:"api",level:2},{value:"Technology Stack",id:"technology-stack",level:2},{value:"Repository Structure",id:"repository-structure",level:2},{value:"Domain entities",id:"domain-entities",level:2},{value:"Defined Events",id:"defined-events",level:2},{value:"Published Defined Events",id:"published-defined-events",level:3},{value:"media/media/created",id:"mediamediacreated",level:4},{value:"Subscribed Defined Events",id:"subscribed-defined-events",level:3},{value:"Imported Events",id:"imported-events",level:2},{value:"Published Imported Events",id:"published-imported-events",level:3},{value:"Subscribed Imported Events",id:"subscribed-imported-events",level:3},{value:"Important ADRs",id:"important-adrs",level:2}];function o(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h1,{id:"media-service",children:"Media Service"}),"\n",(0,s.jsxs)(i.p,{children:["The media service provides the bounded context ",(0,s.jsx)(i.code,{children:"Media"}),".\nIt is responsible for managing media files such as images.\nThe media services uses a Nginx reverse proxy to make the fixed domain of MinIO pre-signed URLs configurable through environment variables."]}),"\n",(0,s.jsxs)(i.p,{children:["A pre-signed URL is used as a reference to a specific media. It is generated for each ",(0,s.jsx)(i.code,{children:"Media"})," entity when the ",(0,s.jsx)(i.code,{children:"path"})," attribute is requested.\nThis is necessary for access control to specific media files. A ",(0,s.jsx)(i.code,{children:"Media"})," entity cannot be queried by a user client directly.\nIt is used in within the service mesh by other services to reference medias in the services datatypes.\nPre-signed URLs link media to authenticated service datatypes, chaining authentication. Each request of the ",(0,s.jsx)(i.code,{children:"path"})," attribute on ",(0,s.jsx)(i.code,{children:"Media"})," generates a new pre-signed URL with a limited validity duration.\nIn other words, presigned URLS are generated automatically without any interference and attachments will always vanish once the presigned URL is no longer valid"]}),"\n",(0,s.jsx)(i.p,{children:"The service parses the following environment variables:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"MINIO_ENDPOINT"}),": configurable domain of the MinIO instance."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"PATH_EXPIRATION_TIME"}),": validity duration of MinIO pre-signed URLs in seconds. A resource can no longer be reached under the pre-signed URL after the pre-signed URL is expired."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"PROXY_PATH"}),": path to include in the pre-signed URLs."]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"domain-model",children:"Domain Model"}),"\n",(0,s.jsx)(r.Z,{path:"/renderedDiagrams/mediaDomainModel",width:"216.50013771199997",height:"93.5"}),"\n",(0,s.jsx)(i.admonition,{type:"info",children:(0,s.jsx)(i.p,{children:"Imported entities from other bounded contexts are marked with a dashed border."})}),"\n",(0,s.jsx)(i.h2,{id:"api",children:"API"}),"\n",(0,s.jsx)(i.p,{children:"The service provides a GraphQL API, which is documented in the GraphQL API documentation (TODO)."}),"\n",(0,s.jsx)(i.h2,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Language"}),": Rust"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Framework"}),": ",(0,s.jsx)(i.a,{href:"https://docs.rs/axum/latest/axum/",children:"axum"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"GraphQL Library"}),": ",(0,s.jsx)(i.a,{href:"https://docs.rs/async-graphql/latest/async_graphql/",children:"async_graphql"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Database"}),": MinIO"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Reverse Proxy"}),": Nginx ",(0,s.jsx)(i.a,{href:"https://nginx.org/en/",children:"nginx"})]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"repository-structure",children:"Repository Structure"}),"\n",(0,s.jsx)(i.p,{children:"The repository is structured as follows:"}),"\n",(0,s.jsx)("div",{className:"repository-structure",children:(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/src"}),": Source code of the service","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/authorization.rs"}),": Header authorization logic of service"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/event"}),": Dapr event handling","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/model"}),": Event DTOs","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/media_dto.rs"}),": Media DTO"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/graphql"}),": GraphQL API","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/model"}),": GraphQL types","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/connection"}),": GraphQL connection types","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/media_connection.rs"}),": GraphQL connection of medias"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/media.rs"}),": Media datatype"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/mutation.rs"}),": GraphQL mutations and associated functions"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/query.rs"}),": GraphQL queries and associated functions"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"/main.rs"}),": Service execution and schema generation"]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(i.h2,{id:"domain-entities",children:"Domain entities"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"interface Media {\n   id: string;\n   path: string,\n}\n"})}),"\n",(0,s.jsx)(i.h2,{id:"defined-events",children:"Defined Events"}),"\n",(0,s.jsx)(i.p,{children:"This section lists events that are defined by the media service and can be used by other services."}),"\n",(0,s.jsx)(i.h3,{id:"published-defined-events",children:"Published Defined Events"}),"\n",(0,s.jsx)(i.h4,{id:"mediamediacreated",children:"media/media/created"}),"\n",(0,s.jsx)(i.p,{children:"This event is published when a media is created."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-tsx",children:"{\n  id: string;\n}\n"})}),"\n",(0,s.jsx)(i.h3,{id:"subscribed-defined-events",children:"Subscribed Defined Events"}),"\n",(0,s.jsx)(i.p,{children:"n/a"}),"\n",(0,s.jsx)(i.h2,{id:"imported-events",children:"Imported Events"}),"\n",(0,s.jsx)(i.p,{children:"This section lists events defined by other services that are used by the media service."}),"\n",(0,s.jsx)(i.h3,{id:"published-imported-events",children:"Published Imported Events"}),"\n",(0,s.jsx)(i.p,{children:"n/a"}),"\n",(0,s.jsx)(i.h3,{id:"subscribed-imported-events",children:"Subscribed Imported Events"}),"\n",(0,s.jsx)(i.p,{children:"n/a"}),"\n",(0,s.jsx)(i.h2,{id:"important-adrs",children:"Important ADRs"}),"\n",(0,s.jsx)(i.p,{children:"n/a"})]})}function u(e={}){const{wrapper:i}={...(0,d.a)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},4106:(e,i,n)=>{n.d(i,{Z:()=>h});var s=n(92949),d=n(44996),r=n(67294),t=n(99276),c=n(85893);function a(e){let{image:i}=e;const s=(0,r.useId)();return(0,r.useEffect)((()=>{let e=new t.Z({gallery:"#"+CSS.escape(s),children:"a",pswpModule:()=>n.e(15826).then(n.bind(n,15826))});return e.init(),()=>{e.destroy(),e=null}}),[]),(0,c.jsx)("div",{className:"pswp-gallery",id:s,children:(0,c.jsx)("a",{href:i.url,"data-pswp-width":i.width,"data-pswp-height":i.height,target:"_blank",rel:"noreferrer",children:(0,c.jsx)("img",{src:i.url,alt:i.alt})},s+"-0")})}var l=n(91262);function h(e){let{path:i,extension:n,alt:r,width:t,height:h}=e;const{colorMode:o}=(0,s.I)(),u={url:(0,d.Z)(`${i}-${o}.${n??"svg"}`),alt:r,width:t,height:h};return(0,c.jsx)(l.Z,{children:()=>(0,c.jsx)(a,{image:u})})}}}]);