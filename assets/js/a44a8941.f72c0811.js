"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[95084],{27148:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>l});var r=s(85893),d=s(11151),i=s(4106);const t={},c="Order Service",o={id:"docs/dev-manuals/services/order",title:"Order Service",description:"The order service provides the bounded context Order.",source:"@site/docs/docs/dev-manuals/services/order.mdx",sourceDirName:"docs/dev-manuals/services",slug:"/docs/dev-manuals/services/order",permalink:"/docs/docs/dev-manuals/services/order",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Notification Service",permalink:"/docs/docs/dev-manuals/services/notification"},next:{title:"Payment Service",permalink:"/docs/docs/dev-manuals/services/payment"}},a={},l=[{value:"Domain Model",id:"domain-model",level:2},{value:"API",id:"api",level:2},{value:"Technology Stack",id:"technology-stack",level:2},{value:"Repository Structure",id:"repository-structure",level:2},{value:"Defined Events",id:"defined-events",level:2},{value:"Published Defined Events",id:"published-defined-events",level:3},{value:"order/order/created",id:"orderordercreated",level:4},{value:"order/order-compensation/created",id:"orderorder-compensationcreated",level:4},{value:"Subscribed Defined Events",id:"subscribed-defined-events",level:3},{value:"Imported Events",id:"imported-events",level:2},{value:"Published Imported Events",id:"published-imported-events",level:3},{value:"Subscribed Imported Events",id:"subscribed-imported-events",level:3},{value:"Important ADRs",id:"important-adrs",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"order-service",children:"Order Service"}),"\n",(0,r.jsxs)(n.p,{children:["The order service provides the bounded context ",(0,r.jsx)(n.code,{children:"Order"}),".\nIt is responsible for managing orders of users."]}),"\n",(0,r.jsx)(n.h2,{id:"domain-model",children:"Domain Model"}),"\n",(0,r.jsx)(i.Z,{path:"/renderedDiagrams/orderDomainModel",width:"1320",height:"682.75"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Imported entities from other bounded contexts are marked with a dashed border."})}),"\n",(0,r.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,r.jsx)(n.p,{children:"The service provides a GraphQL API, which is documented in the GraphQL API documentation (TODO)."}),"\n",(0,r.jsx)(n.h2,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Language"}),": Rust"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Framework"}),": ",(0,r.jsx)(n.a,{href:"https://docs.rs/axum/latest/axum/",children:"axum"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GraphQL Library"}),": ",(0,r.jsx)(n.a,{href:"https://docs.rs/async-graphql/latest/async_graphql/",children:"async_graphql"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database"}),": MongoDB"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"repository-structure",children:"Repository Structure"}),"\n",(0,r.jsx)(n.p,{children:"The repository is structured as follows:"}),"\n",(0,r.jsx)("div",{className:"repository-structure",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/src"}),": Source code of the service","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/authorization.rs"}),": Header authorization logic of service"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/event"}),": Dapr event handling","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/http_event_service.rs"}),": Handling of incoming events"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/model"}),": Event DTOs","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_compenstation_dto.rs"}),": Order compensation DTO"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_dto.rs"}),": Order DTO"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_item_dto.rs"}),": Order item DTO"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_compenstation.rs"}),": Compensation logic on ",(0,r.jsx)(n.code,{children:"shipment/shipment/creation/failed"})," event"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/graphql"}),": GraphQL API","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/model"}),": GraphQL types","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/connection"}),": GraphQL connection types","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/base_connection.rs"}),": Generic GraphQL connection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/discount_connection.rs"}),": GraphQL connection of discount"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_connection.rs"}),": GraphQL connection of order"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_item_connection.rs"}),": GraphQL connection of an order item"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/product_variant_version_connection.rs"}),": GraphQL connection of a product variant version"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/foreign_types.rs"}),": Datatypes which are not part of the services bounded context"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_datatypes.rs"}),": GraphQL datatypes for connection element ordering"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order_item.rs"}),": Order item datatype"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/order.rs"}),": Order datatype"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/payment_authorization.rs"}),": Payment authorization datatype"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/user.rs"}),": User with additional GraphQL field(s) provided by this service"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/mutation_input_structs.rs"}),": GraphQL input datatypes for mutations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/mutation.rs"}),": GraphQL mutations and associated functions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/query.rs"}),": GraphQL queries and associated functions"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/main.rs"}),": Service execution and schema generation"]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"defined-events",children:"Defined Events"}),"\n",(0,r.jsx)(n.p,{children:"This section lists events that are defined by the order service and can be used by other services."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"interface OrderItem {\n  id: string;\n  createdAt: string;\n  productVariantId: string;\n  productVariantVersionId: string;\n  taxRateVersionId: string;\n  shoppingCartItemId: string;\n  count: number;\n  compensatableAmount: number;\n  shipmentMethodId: string;\n  discountIds: string[];\n}\n\ninterface PaymentAuthorization {\n  cvc: number;\n}\n\nenum OrderStatus {\n  PENDING,\n  PLACED,\n  REJECTED\n}\n\nenum RejectionReason {\n  INVALID_ORDER_DATA,\n  INVENTORY_RESERVATION_FAILED\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"published-defined-events",children:"Published Defined Events"}),"\n",(0,r.jsx)(n.h4,{id:"orderordercreated",children:"order/order/created"}),"\n",(0,r.jsxs)(n.p,{children:["This event is published when an order is placed, which means its order status is set to ",(0,r.jsx)(n.code,{children:"PLACED"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"{\n  id: string;\n  userId: string;\n  createdAt: string;\n  orderStatus: OrderStatus;\n  placedAt: string;\n  rejectionReason?: RejectionReason;\n  orderItems: OrderItem[];\n  shipmentAddressId: string;\n  invoiceAddressId: string;\n  compensatableOrderAmount: number;\n  paymentInformationId: string;\n  paymentAuthorization?: PaymentAuthorization;\n  vatNumber?: string;\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"orderorder-compensationcreated",children:"order/order-compensation/created"}),"\n",(0,r.jsx)(n.p,{children:"This event is published when an order should be compensated due to a failed shipment."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"{\n  id: string,\n  orderId: string,\n  orderItemIds: string[],\n  triggeredAt: DateTime,\n  amountToCompensate: number\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"subscribed-defined-events",children:"Subscribed Defined Events"}),"\n",(0,r.jsx)(n.p,{children:"n/a"}),"\n",(0,r.jsx)(n.h2,{id:"imported-events",children:"Imported Events"}),"\n",(0,r.jsx)(n.p,{children:"This section lists events defined by other services that are used by the order service."}),"\n",(0,r.jsx)(n.h3,{id:"published-imported-events",children:"Published Imported Events"}),"\n",(0,r.jsx)(n.p,{children:"n/a"}),"\n",(0,r.jsx)(n.h3,{id:"subscribed-imported-events",children:"Subscribed Imported Events"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/catalog#catalogproduct-variant-versioncreated",children:"catalog/product-variant-version/created"}),": Used to obtain the current product variant versions for product variants."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/discount#discountcouponcreated",children:"discount/coupon/created"}),": Used to validate the existence of coupons."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/tax#taxtax-rate-versioncreated",children:"tax/tax-rate-version/created"}),": Used to obtain the current tax rate versions for tax rates."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/shipment#shipmentshipment-methodcreated",children:"shipment/shipment-method/created"}),": Used to validate the existence of shipment methods."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/user#userusercreated",children:"user/user/created"}),": Used to validate that orders belong to an existing user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/address#addressuser-addresscreated",children:"address/user-address/created"}),": Used to validate that addresses exist for a user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/address#addressuser-addresscreated",children:"address/user-address/archived"}),": Used to validate that addresses exist for a user."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/shipment#shipmentshipmentcreation-failed",children:"shipment/shipment/creation-failed"}),": Used to trigger order compensation for a shipment."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"important-adrs",children:"Important ADRs"}),"\n",(0,r.jsx)(n.p,{children:"n/a"})]})}function u(e={}){const{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},4106:(e,n,s)=>{s.d(n,{Z:()=>l});var r=s(92949),d=s(44996),i=s(67294),t=s(99276),c=s(85893);function o(e){let{image:n}=e;const r=(0,i.useId)();return(0,i.useEffect)((()=>{let e=new t.Z({gallery:"#"+CSS.escape(r),children:"a",pswpModule:()=>s.e(15826).then(s.bind(s,15826))});return e.init(),()=>{e.destroy(),e=null}}),[]),(0,c.jsx)("div",{className:"pswp-gallery",id:r,children:(0,c.jsx)("a",{href:n.url,"data-pswp-width":n.width,"data-pswp-height":n.height,target:"_blank",rel:"noreferrer",children:(0,c.jsx)("img",{src:n.url,alt:n.alt})},r+"-0")})}var a=s(91262);function l(e){let{path:n,extension:s,alt:i,width:t,height:l}=e;const{colorMode:h}=(0,r.I)(),u={url:(0,d.Z)(`${n}-${h}.${s??"svg"}`),alt:i,width:t,height:l};return(0,c.jsx)(a.Z,{children:()=>(0,c.jsx)(o,{image:u})})}}}]);