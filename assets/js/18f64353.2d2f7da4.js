"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[48888],{52337:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>c,toc:()=>o});var r=s(85893),d=s(11151),i=s(4106);const t={},l="Payment Service",c={id:"docs/dev-manuals/services/payment",title:"Payment Service",description:"The payment service consists of the bounded contexts Payment, PaymentInformation and PaymentMethod.",source:"@site/docs/docs/dev-manuals/services/payment.mdx",sourceDirName:"docs/dev-manuals/services",slug:"/docs/dev-manuals/services/payment",permalink:"/docs/docs/dev-manuals/services/payment",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Order Service",permalink:"/docs/docs/dev-manuals/services/order"},next:{title:"Return Service",permalink:"/docs/docs/dev-manuals/services/return"}},a={},o=[{value:"Domain Model",id:"domain-model",level:2},{value:"API",id:"api",level:2},{value:"REST API",id:"rest-api",level:3},{value:"Technology Stack",id:"technology-stack",level:2},{value:"Repository Structure",id:"repository-structure",level:2},{value:"Defined Events",id:"defined-events",level:2},{value:"Published Defined Events",id:"published-defined-events",level:3},{value:"payment/payment/payment-enabled",id:"paymentpaymentpayment-enabled",level:4},{value:"payment/payment/payment-processed",id:"paymentpaymentpayment-processed",level:4},{value:"payment/payment/payment-failed",id:"paymentpaymentpayment-failed",level:4},{value:"Subscribed Defined Events",id:"subscribed-defined-events",level:3},{value:"Imported Events",id:"imported-events",level:2},{value:"Published Imported Events",id:"published-imported-events",level:3},{value:"Subscribed Imported Events",id:"subscribed-imported-events",level:3},{value:"Important ADRs",id:"important-adrs",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"payment-service",children:"Payment Service"}),"\n",(0,r.jsxs)(n.p,{children:["The payment service consists of the bounded contexts ",(0,r.jsx)(n.code,{children:"Payment"}),", ",(0,r.jsx)(n.code,{children:"PaymentInformation"})," and ",(0,r.jsx)(n.code,{children:"PaymentMethod"}),".\nIt is responsible for handling the payment prozess and managing ",(0,r.jsx)(n.code,{children:"Users"})," payment Infotmations. It is part of the order and return saga, where it captures the payments for ",(0,r.jsx)(n.code,{children:"Orders"})," or refunds the payment after an ",(0,r.jsx)(n.code,{children:"Return"}),".\nIt ",(0,r.jsx)(n.em,{children:"is not a payment provider"})," but simulates communicating with one via the ",(0,r.jsx)(n.code,{children:"Simulation"})," Service."]}),"\n",(0,r.jsx)(n.h2,{id:"domain-model",children:"Domain Model"}),"\n",(0,r.jsx)(i.Z,{path:"/renderedDiagrams/paymentDomainModel",width:"790",height:"593.5"}),"\n",(0,r.jsx)(n.h2,{id:"api",children:"API"}),"\n",(0,r.jsx)(n.p,{children:"The service provides a GraphQL API."}),"\n",(0,r.jsx)(n.h3,{id:"rest-api",children:"REST API"}),"\n",(0,r.jsx)(n.p,{children:"The service provides a REST API which is used by the external payment provider to inform about payment status changes."}),"\n",(0,r.jsx)(n.h2,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Language"}),": TypeScript"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Framework"}),": NestJS"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GraphQL Library"}),": @nestjs/graphql with @nestjs/apollo (code first)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database"}),": MongoDB"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Entity Management"}),": Mongoose"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"repository-structure",children:"Repository Structure"}),"\n",(0,r.jsx)(n.p,{children:"The repository is structured as follows:"}),"\n",(0,r.jsx)("div",{className:"repository-structure",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/src/"}),": Source code of the service","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"events/"}),": Dapr event handling","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dto/"}),": Event DTOs"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"graphql-types/"}),": Shared Types for graphQL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"health/"}),": Health API"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"open-orders/"}),": Module for imported, pending ",(0,r.jsx)(n.code,{children:"Orders"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"entities/"}),": Imported Order persistet entities"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payment/"}),": Module for ",(0,r.jsx)(n.code,{children:"Payments"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dto"}),": Inventory DTOs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"entities/"}),": Inventory persistet entities"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payment-information/"}),": Module for ",(0,r.jsx)(n.code,{children:"PaymentInformations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dto"}),": PaymentInformation DTOs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"entities/"}),": PaymentInformation persistet entities"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"product-method/"}),": Folder for everything related to ",(0,r.jsx)(n.code,{children:"PaymentMethods"})," Module"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payment-provider-connection/"}),": Module for the communication with external payment Providers","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dto"}),": Payment Provider Communication DTOs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payment-processors/"}),": Payment processing logic for each ",(0,r.jsx)(n.code,{children:"PaymentMethod"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"shared/"}),": Shared Code between different modules","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"constants"}),": Shared constants"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"decorators"}),": Shared decorators"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"enums"}),": Shared enumerators"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"guards"}),": Shared guards"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"interfaces"}),": Shared interfaces"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"logger"}),": Logging configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pipes"}),": Shared Pipelines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scalars"}),": Shared graphQL scalars"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"utils"}),": Shared helpers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"validators"}),": Shared validators"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"defined-events",children:"Defined Events"}),"\n",(0,r.jsx)(n.p,{children:"This section lists events that are defined by the payment service and can be used by other services."}),"\n",(0,r.jsx)(n.h3,{id:"published-defined-events",children:"Published Defined Events"}),"\n",(0,r.jsx)(n.h4,{id:"paymentpaymentpayment-enabled",children:"payment/payment/payment-enabled"}),"\n",(0,r.jsx)(n.p,{children:"This event is published when all steps necessary to be able to process a payment were successfully completed.\nIt indicates, that other services can continue the order saga."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"{\n  order: Order;\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"paymentpaymentpayment-processed",children:"payment/payment/payment-processed"}),"\n",(0,r.jsx)(n.p,{children:"This event is published when the full payment amount was successfully captured."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"{\n  order: Order;\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"paymentpaymentpayment-failed",children:"payment/payment/payment-failed"}),"\n",(0,r.jsx)(n.p,{children:"This event is published when the payment fails finally after its retries."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"{\n  order: Order,\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"subscribed-defined-events",children:"Subscribed Defined Events"}),"\n",(0,r.jsx)(n.p,{children:"n/a"}),"\n",(0,r.jsx)(n.h2,{id:"imported-events",children:"Imported Events"}),"\n",(0,r.jsx)(n.p,{children:"This section lists events defined by other services that are used by the catalog service."}),"\n",(0,r.jsx)(n.h3,{id:"published-imported-events",children:"Published Imported Events"}),"\n",(0,r.jsx)(n.p,{children:"n/a"}),"\n",(0,r.jsx)(n.h3,{id:"subscribed-imported-events",children:"Subscribed Imported Events"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/user#userusercreated",children:"user/user/created"}),": Used to create default payment Methods for each user when created."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/services/discount#discountordervalidation-succeeded",children:"discount/order/validation-succeeded"}),": Used to start the payment process after the previous steps finished successfully."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"important-adrs",children:"Important ADRs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/docs/dev-manuals/adr/health-endpoint",children:"Service Health Endpoint"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},4106:(e,n,s)=>{s.d(n,{Z:()=>o});var r=s(92949),d=s(44996),i=s(67294),t=s(99276),l=s(85893);function c(e){let{image:n}=e;const r=(0,i.useId)();return(0,i.useEffect)((()=>{let e=new t.Z({gallery:"#"+CSS.escape(r),children:"a",pswpModule:()=>s.e(15826).then(s.bind(s,15826))});return e.init(),()=>{e.destroy(),e=null}}),[]),(0,l.jsx)("div",{className:"pswp-gallery",id:r,children:(0,l.jsx)("a",{href:n.url,"data-pswp-width":n.width,"data-pswp-height":n.height,target:"_blank",rel:"noreferrer",children:(0,l.jsx)("img",{src:n.url,alt:n.alt})},r+"-0")})}var a=s(91262);function o(e){let{path:n,extension:s,alt:i,width:t,height:o}=e;const{colorMode:h}=(0,r.I)(),p={url:(0,d.Z)(`${n}-${h}.${s??"svg"}`),alt:i,width:t,height:o};return(0,l.jsx)(a.Z,{children:()=>(0,l.jsx)(c,{image:p})})}}}]);